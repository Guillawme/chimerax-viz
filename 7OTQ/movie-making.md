# Making movies from a cryoDRGN graph traversal

Minimal example (a [ChimeraX command file](https://www.cgl.ucsf.edu/chimerax/docs/user/commands/usageconventions.html#cxc-files)):

```
# Open your maps as a volume series
open vol_???.mrc vseries true

# Global display options
set bgcolor white
lighting soft
graphics silhouettes true
# Use same color as in the cryoDRGN paper
volume #1 color cornflowerblue

# Adjust map contour level and optionally remove speckles
# Adjust these numbers to whatever makes sense in your specific case
# If you set the contour level interactively with the slider, it will print the value
# in the Log and you can then write down this value here; this value is also
# shown in a text box just above the contour level slider
volume #1 level 0.01
surface dust #1 size 10

# Generate a movie going through the volume series

# The 'graphics rate maxframerate 30' command causes the resulting movie to be at 30 frames per second
# instead of whatever the default is in ChimeraX (I think it's 60); I chose 30 fps
# because it is the default export frame rate in OpenShot, the movie editing software I subsequently 
# used to assemble several movie files into a single movie

# To adjust the number of steps through the volume series per second, you need to
# play with the 'pauseframes 15' and 'wait 900' numbers:
# I had 59 volumes and wanted to go through them at 2 volumes per second
# so 'pauseframes 15' keeps each step in the volume series displayed for 15 movie frames (so 0.5 s at 30 fps)
# before changing to the next volume
# and 'wait 900' makes the entire movie 900 frames (so 30 s at 30 fps)

view #1
graphics rate maxframerate 30
#Forward direction movie
vseries play #1 jumpto 0
movie record
vseries play #1 normalize true pauseframes 15; wait 900
movie stop
movie encode forward.mp4 framerate 30
# Reverse direction movie
vseries play #1 jumpto 9
movie record
vseries play #1 normalize true direction backward pauseframes 15; wait 900
movie stop
movie encode backward.mp4 framerate 30
```

The article I was making movies for [is now published](https://doi.org/10.7554/eLife.71420), so I posted my scripts [in this repository](https://github.com/Guillawme/chimerax-viz/tree/main/7OTQ) and you can see the corresponding movies [here](https://elifesciences.org/articles/71420/figures#videos). This should complement well the generic example above.

Here are the steps I followed to generate the animated UMAP plot in the graph traversal movie, only using free/open-source software:

1. I adapted the Jupyter notebook generated by `cryodrgn analyze` to make it [plot a red dot](https://github.com/Guillawme/chimerax-viz/blob/main/7OTQ/plot-graph-traversal-trajectory-on-umap.ipynb) at the coordinate of each reconstruction in the volume series and save each plot as a PNG file
2. I [used `ffmpeg`](https://github.com/Guillawme/chimerax-viz/blob/main/7OTQ/make-umap-movie.sh) to assemble all these PNG files into an animation with the same frame rate as the volume series movie from ChimeraX (not only the same frame rate, but also the same "step rate" through the volume series and the corresponding UMAP coordinate series, so that the next dot on the UMAP plot would appear at the same time as the next map in the volume series)
3. I used [OpenShot Video Editor](https://www.openshot.org/) to assemble the two movies next to each other in a single movie file, which required minimal video editing skills since the two movies already had the same frame rate and "step rate"

I hope this helps!
